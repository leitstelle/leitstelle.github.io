<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: debian | Leitstelle]]></title>
  <link href="http://leitstelle.github.io/blog/categories/debian/atom.xml" rel="self"/>
  <link href="http://leitstelle.github.io/"/>
  <updated>2014-08-10T20:01:20+02:00</updated>
  <id>http://leitstelle.github.io/</id>
  <author>
    <name><![CDATA[Frank Zisko]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Setup Debian locale]]></title>
    <link href="http://leitstelle.github.io/blog/2013/2013-09-24-setup-debian-locale/"/>
    <updated>2013-09-24T12:26:00+02:00</updated>
    <id>http://leitstelle.github.io/blog/2013/setup-debian-locale</id>
    <content type="html"><![CDATA[<p>Um die locale-Einstellungen zu ändern müssen die folgenden Schritte durchgeführt werden.</p>

<p><figure class='code'><figcaption><span>Check available languages, install missing and update your locales </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;!/bin/bash&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;See installed locales.&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;locale -a&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;You need root rights.&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;su -&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;Install locales&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;For <span class="nb">time </span>format close to ISO <span class="m">8601</span> install <span class="p">&amp;</span>lsquo<span class="p">;</span>en_DK<span class="p">&amp;</span>rsquo<span class="p">;</span>.&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;dpkg-reconfigure locales&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;Edit your locales file. Below you see an example.&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;Attention: If you <span class="nb">set </span>LC_ALL variable, it will overwrite all other options. So, don<span class="p">&amp;</span>rsquo<span class="p">;</span>t use it.&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;nano /etc/default/locale
</span></code></pre></td></tr></table></div></figure></p>

<p>Nun ein logout und ein login und die Einstellungen sind wirksam. Unten ist eine Beispieldatei für eine locale abgebildet. Achtung: Wird die LC_ALL-Variable gesetzt, so überschreibt diese alle anderen Einstellungen, egal ob sie danach getätigt werden.
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;Example /etc/default/locale file.&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;File generated by update-locale&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;#&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;LC_ADDRESS Convention used <span class="k">for</span> formatting of street or postal addresses&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;LC_ALL High precedence override <span class="k">for</span> locale specific behaviour <span class="o">(</span>overrides all other locale variables<span class="o">)</span>&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;LC_COLLATE Collation order&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;LC_CTYPE Character classification and <span class="k">case</span> conversion&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;LC_LANG Language&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;LC_MONETARY Monetary formatting&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;LC_MEASUREMENT Default measurement system used within the region&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;LC_MESSAGES Format of interactive words and responses&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;LC_NUMERIC Numeric formatting&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;LC_PAPER Default paper size <span class="k">for</span> region&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;LC_RESPONSE Determines how responses <span class="o">(</span>such as Yes and No<span class="o">)</span> appear in the <span class="nb">local </span>language&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;LC_TELEPHONE Conventions used <span class="k">for</span> representation of telephone numbers&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;LC_TIME Date and <span class="nb">time </span>formats&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;LC_LANGUAGE<span class="o">=</span>en_US.utf8
</span><span class='line'><span class="nv">LC_MONETARY</span><span class="o">=</span>de_DE.utf8
</span><span class='line'><span class="nv">LC_MEASUREMENT</span><span class="o">=</span>de_DE.utf8
</span><span class='line'><span class="nv">LC_NUMERIC</span><span class="o">=</span>de_DE.utf8
</span><span class='line'><span class="nv">LC_PAPER</span><span class="o">=</span>de_DE.utf8
</span><span class='line'><span class="nv">LC_TELEPHONE</span><span class="o">=</span>de_DE.utf8
</span><span class='line'><span class="nv">LC_TIME</span><span class="o">=</span>en_DK.UTF-8
</span></code></pre></td></tr></table></div></figure></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Debian Repositories]]></title>
    <link href="http://leitstelle.github.io/blog/2013/2013-09-09-debian-repositories/"/>
    <updated>2013-09-09T08:59:00+02:00</updated>
    <id>http://leitstelle.github.io/blog/2013/debian-repositories</id>
    <content type="html"><![CDATA[<h2>tl;dr</h2>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>su -
</span><span class='line'>man apt-get
</span><span class='line'>nano /etc/apt/sources.list
</span><span class='line'><span class="nb">echo</span> <span class="p">&amp;</span>ldquo<span class="p">;</span>deb &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://www.deb-multimedia.org/&quot;</span>&gt;http://www.deb-multimedia.org/&lt;/a&gt; testing main non-free<span class="p">&amp;</span>rdquo<span class="p">;</span> &gt;&gt; /etc/apt/sources.list
</span><span class='line'>gpg <span class="p">&amp;</span>ndash<span class="p">;</span>keyserver pgp.mit.edu <span class="p">&amp;</span>ndash<span class="p">;</span>recv-keys 07dc563d1f41b907
</span><span class='line'>gpg <span class="p">&amp;</span>ndash<span class="p">;</span>armor <span class="p">&amp;</span>ndash<span class="p">;</span><span class="nb">export </span>07dc563d1f41b907 <span class="p">|</span> apt-key add -
</span><span class='line'>apt-get update
</span></code></pre></td></tr></table></div></figure></p>

<h2>Software</h2>

<p>Debian veröffentlicht Softwarepakete und Aktualisierungen, wie viele Andere GNU/Linux Distributionen über Repositories. Software zur Packetverwaltung ist apt-get, aptitude und synaptic. Synaptic ist das bequeme grafische Frontend. Ob man in der Konsole apt-get oder aptitude verwendet ist eher eine Glaubensfrage. Viele empfehlen nur eines zu verwenden. Wie man synaptic, aptitude oder apt-get verwendet findet in den Manpages.
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>man apt-get
</span><span class='line'>man aptitude
</span></code></pre></td></tr></table></div></figure>
oder im #Neuland.</p>

<h2>Grundlegendes</h2>

<p>Als Benutzer steht es einem frei, welche <strong>Repositories</strong> man verwendet. Ich kann nur empfehlen die offiziellen Repos zu verwenden. Aufgelistet werden diese in der <strong>sources.list</strong>, welche man unter
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>su -
</span><span class='line'>nano /etc/apt/sources.list
</span></code></pre></td></tr></table></div></figure>
findet. In ihr stehen Zeile für Zeile die verschiedenen Quellen.
    deb <a href="http://sub.domain.tld/debian">http://sub.domain.tld/debian</a> version option1 option2 option3
deb beutet, dass es sich um eine <strong>Binärquelle</strong> handelt. Hier sind also Programme und andere ausführbare Pakete enthalten. (deb-src wäre eine <strong>Codequelle</strong> für Sourcecode.) Danach folgt die Quelle, neben http können auch ftp und mit dem entsprechenden Erweiterung auch https (oder sogar torrents) als Quellen angegeben werden. Version steht für die verwendete Debian Version. nachfolgend kann man 3 Optionen eintragen. Diese können beliebig kombiniert werden. Eine muss jedoch genannt werden. Benutzt man beispielsweise Wheezy, also Debian 7, dann sähe die Quelle mit allen Optionen so aus:
    deb <a href="http://ftp.de.debian.org/debian">http://ftp.de.debian.org/debian</a> stable main contrib non-free</p>

<p>Beachte:  Die Quellen müssen nicht in der /etc/apt/sources.list hinzugefügt werden. Im Verzeichnis /etc/apt/sources.list.d können einzelne Quellen abgelegt werden. Z.B. in: /etc/apt/sources.list.d/my.list . Häufig wird dies durch von Webseiten heruntergeladene Pakete erstellt. Es soll i.d.R. die Aktualität gewährleisten. Aufmerksamkeit ist geboten.</p>

<h2>Sicherheit</h2>

<p>Um sicher zu Stellen, dass die Pakete, welche durch die Quelle bereit gestellt werden auch vertrauenswürdig sind, werden <strong>Schlüssel</strong> im Paketmanager hinterlegt. Nach der Installation sind bereits die Schlüssel der Standartquellen (debian.org) hinterlegt. Möchte man jedoch weitere Quellen hinzufügen ist es sehr ratsam deren Schlüssel ebenfalls hinzuzufügen. Damit wird für jedes Paket, welches man über diese Quelle herunter laden möchte überprüft, ob dieses signiert wurde und ob die Signatur mit der der Quelle übereinstimmt.</p>

<h2>Quellen</h2>

<p>Man kann einen offiziellen Mirror oder einen nicht offiziellen Mirror verwenden. Ebenso gibt es zahlreiche spezielle Repos, welche nur eine bestimmte Software anbieten. <strong>Wichtig ist</strong>: Überlege dir, ob du den nicht-offiziellen Quellen vertraust. Auch wenn sie aktuell nur diese eine Software anbieten, können sie dir später durch Updates Schadcode einfügen. Um das zu demonstrieren hatte ein BLOG einmal den Standard-Hintergrund geändert und mit einer Warnung versehen, dass man eben darauf achten soll. Das ist ein gutes Beispiel.</p>

<p>Für die Konsolen-Editierung der Quellen wird die sources.list aufgerufen.
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>su -
</span><span class='line'>nano /etc/apt/sources.list
</span></code></pre></td></tr></table></div></figure>
Repo-Zeilen werden in folgender Form eingefügt:
    deb-src <a href="http://sub.domain.tld/debian">http://sub.domain.tld/debian</a> version option1 option2 option3
Bsp.:
    deb <a href="http://http.us.debian.org/debian">http://http.us.debian.org/debian</a> testing main contrib non-free
    deb-src <a href="http://ftp.de.debian.org/debian">http://ftp.de.debian.org/debian</a> testing main contrib non-free</p>

<p>Um den Schlüssel für ein Repo hinzuzufügen wird dies wie folgt vom Schlüsselserver geladen und der Softwareverwaltung hinzu gefügt (siehe auch <a href="https://wiki.debian.org/SecureApt">https://wiki.debian.org/SecureApt</a>):
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>su -&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;Schlüssel vom Server holen. Darauf achten, den Richtigen zu holen&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;gpg <span class="p">&amp;</span>ndash<span class="p">;</span>keyserver pgp.mit.edu <span class="p">&amp;</span>ndash<span class="p">;</span>recv-keys 1F41B907&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;Den Schlüssel aus dem Schlüsselring holen und apt hinzufügen:&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;gpg <span class="p">&amp;</span>ndash<span class="p">;</span>armor <span class="p">&amp;</span>ndash<span class="p">;</span><span class="nb">export </span>1F41B907 <span class="p">|</span> apt-key add -&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;Update Repo&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;apt-get update
</span></code></pre></td></tr></table></div></figure></p>

<h2>Beispiel für meine verwendeten Repositories</h2>

<p>Ich verwende Debian Testing (8 / Jessie).</p>

<h3>sources.list</h3>

<p><figure class='code'><figcaption><span>My debian testing sources. (debian-sources.list)</span> <a href='/downloads/code/2013/debian-sources.list'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c"># Debian</span>
</span><span class='line'>deb http://ftp.de.debian.org/debian/ testing main contrib non-free
</span><span class='line'>deb-src http://ftp.de.debian.org/debian/ testing main contrib non-free
</span><span class='line'>
</span><span class='line'><span class="c"># Updates</span>
</span><span class='line'>deb http://ftp.de.debian.org/debian/ testing-updates main contrib non-free
</span><span class='line'>deb-src http://ftp.de.debian.org/debian/ testing-updates main contrib non-free
</span><span class='line'>
</span><span class='line'><span class="c"># Security</span>
</span><span class='line'>deb http://security.debian.org/ testing/updates main contrib non-free
</span><span class='line'>deb-src http://security.debian.org/ testing/updates main contrib non-free
</span><span class='line'>
</span><span class='line'><span class="c"># Backports</span>
</span><span class='line'><span class="c">#deb http://ftp.debian.org/debian/ jessie-backports main contrib non-free</span>
</span><span class='line'><span class="c">#deb-src http://ftp.debian.org/debian/ jessie-backports main contrib non-free</span>
</span><span class='line'>
</span><span class='line'><span class="c">################################################################################</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Mutlimedia</span>
</span><span class='line'><span class="c">#deb http://www.deb-multimedia.org/ testing main non-free</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Mozilla</span>
</span><span class='line'><span class="c">#deb http://mozilla.debian.net/ wheezy-backports iceweasel-release</span>
</span><span class='line'><span class="c">#deb-src http://mozilla.debian.net/ wheezy-backports iceweasel-release</span>
</span><span class='line'>
</span><span class='line'><span class="c"># VLC</span>
</span><span class='line'><span class="c">#deb http://download.videolan.org/pub/debian/stable/ /</span>
</span><span class='line'>
</span><span class='line'><span class="c"># NeuroDebian</span>
</span><span class='line'><span class="c">#deb http://neurodebian.ovgu.de/debian/ data main contrib non-free</span>
</span><span class='line'><span class="c">#deb-src http://neurodebian.ovgu.de/debian/ data main contrib non-free</span>
</span><span class='line'><span class="c">#deb http://neurodebian.ovgu.de/debian/ jessie main contrib non-free</span>
</span><span class='line'><span class="c">#deb-src http://neurodebian.ovgu.de/debian/ jessie main contrib non-free</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Google</span>
</span><span class='line'><span class="c">#deb http://dl.google.com/linux/deb/ stable main</span>
</span><span class='line'><span class="c">#deb http://dl.google.com/linux/musicmanager/deb/ stable main</span>
</span></code></pre></td></tr></table></div></figure></p>

<h3>get keys</h3>

<p><figure class='code'><figcaption><span>Get debian repo keys. (debian-get-apt-keys.sh)</span> <a href='/downloads/code/2013/debian-get-apt-keys.sh'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'><span class="c">################################################################################</span>
</span><span class='line'><span class="c"># Check before you run this. </span>
</span><span class='line'><span class="c"># NO WARRANTY!!!</span>
</span><span class='line'><span class="c"># Run as root.</span>
</span><span class='line'><span class="c">################################################################################</span>
</span><span class='line'>
</span><span class='line'><span class="c"># DebianMultimedia - http://www.deb-multimedia.org/</span>
</span><span class='line'>gpg --keyserver pgp.mit.edu --recv-keys 07dc563d1f41b907
</span><span class='line'>gpg --armor --export 07dc563d1f41b907 <span class="p">|</span> apt-key add -
</span><span class='line'>
</span><span class='line'><span class="c"># DebianMozilla - http://mozilla.debian.net/</span>
</span><span class='line'>gpg --keyserver pgp.mit.edu --recv-keys 85A3D26506C4AE2A
</span><span class='line'>gpg --armor --export 85A3D26506C4AE2A <span class="p">|</span> apt-key add -
</span><span class='line'>
</span><span class='line'><span class="c"># VLC - http://download.videolan.org/</span>
</span><span class='line'>wget -O - http://download.videolan.org/pub/debian/videolan-apt.asc <span class="p">|</span> apt-key add -
</span><span class='line'>
</span><span class='line'><span class="c"># NeuroDebian - http://neurodebian.ovgu.de/</span>
</span><span class='line'>gpg --keyserver pgp.mit.edu --recv-keys A5D32F012649A5A9
</span><span class='line'>gpg --armor --export A5D32F012649A5A9 <span class="p">|</span> apt-key add -
</span><span class='line'>
</span><span class='line'><span class="c"># Google - http://dl.google.com/</span>
</span><span class='line'>gpg --keyserver pgp.mit.edu --recv-keys A040830F7FAC5991
</span><span class='line'>gpg --armor --export A040830F7FAC5991 <span class="p">|</span> apt-key add -
</span></code></pre></td></tr></table></div></figure></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[GNU/Linux Debian installieren]]></title>
    <link href="http://leitstelle.github.io/blog/2013/2013-09-05-debian-installieren/"/>
    <updated>2013-09-05T20:40:00+02:00</updated>
    <id>http://leitstelle.github.io/blog/2013/debian-installieren</id>
    <content type="html"><![CDATA[<p>Diese ist die Installationsanleitung eines Debian-Betriebssystem auf einen Computer. Bei dieser Anleitung wird vorrausgesetz, dass es nur ein Betriebssystem auf dem PC geben wird. Sollte z.B. noch ein Windows (mit Truecrypt verschlüsselt) verwendet werden, ist eineandere Boot-Manager-Konfiguration notwendig. Dazu mehr in einen folgenden Beitrag.
Auch werden die anzulegenden Partitionen einzeln angelegt und mittels einer Schlüsselableitungbeim Booten geöffnet. Alternativ könnte in eine alles umfassendes verschlüsselte Partitino ein LVM (Logical Volume Manager) installiert werden. In diesem könnendann beliebige Partitionen erstellt werden. Vorteil: Was bei der vorher genannten Methode durch die Schlüsselableitung erreicht wird (beim booten nur ein Passwort eingeben.) ist hier von anfang an dabei. Auch können Partitionseinstellungen, wi z.B. Größe, geändert werden.</p>

<h2>tl:dr</h2>

<ol>
<li>Debian-Image auf USB-Stick kopieren</li>
<li>Debian installieren

<ul>
<li>Manuelle Partitionierung</li>
<li>Boot unverschlüsselt</li>
<li>System, Home, Swap verschlüsselt; Swap nicht mounten</li>
</ul>
</li>
<li>Reboot</li>
<li>Schlüsselableitung von System nach Home und von System nach Swap</li>
<li>crypttab und fstab anpassen</li>
<li>Reboot</li>
</ol>


<h2>Vorwissen</h2>

<h3>Partitionierung</h3>

<p>Im wesentlichen ist die Installation recht einfach. Knackpunkt, bei der Installation eines verschlüsseltem System, ist häufig die Partitionierung. Unter Windows werden z.B. die Partitionen durch Buchstaben durchnummeriert. Unabhängig auf welcher Festplatte diese Partition liegt. Die Platten können dann direkt unter den Buchstaben angesprochen werden. Kein Buchstab,e kein Ansprechen.</p>

<p>Unter Linux-artigen System werden die Platten der Reihe nach durch nummeriert. Diese werden als Gerät (Device) geführt. Diese sind unter <code>/dev</code> zu finden. Handelt es sich um eine IDE-Festplatte werden die Platten hda, hdb, hdc, hdd, hde, &hellip; durch gezählt (hdX). Handelt es sich um SATA-Festplatten werden diese sda, sdb, cdc, &hellip; gezählt (sdX). Um einzelne Partitionen anzusprechen werden diese ebenfalls durch gezählt hdb1, hdb2, hdb3, hdb4, &hellip; .
Beispiel die erste Partition auf einer SATA-Platte, welche als dritte im System erkannt wurde ist <code>/dev/sdc1</code>. c steht für die 3 Festplatte, 1 für die erste Partition.</p>

<p>Um diese Partitionen anzusprechen müssen diese noch gemountet werden. Die Platten werden damit dort &lsquo;eingehangen&rsquo;, wo sie benötigt werden. Ein System braucht bestimmte Ordner. Wichtige Ordner sind der Dateisystem-Root <code>/</code> ohne diesen gibt es kein Betriebssystem. Von diesem stammen ALLE Unterverzeichnisse ab. Man könnte also ein Betriebssystem in eine Partition installieren und diese dann als &#8220; einhängen und das System funktioniert. Häufig werden wichtige Ordner wie die Boot-Partition (/boot) und die Nutzer-Partition (/home) in anderen Partition gespeichert. Das hat Vorteil, wenn das System kaputt ist, verschiedene Festplatten verwendet werden sollen oder auch Netzwerklaufwerke verwendet werden sollen.</p>

<p>Eine typische Konfiguration ist z.B. für eine SATA-Platte</p>

<pre><code>/dev/sda (Ist die Gesamte Festplatte ab dem Bootsektor)
/dev/sda1 -&gt; /boot
/dev/sda2 -&gt; /
/dev/sda3 -&gt; /home
/dev/sda4 -&gt; SWAP
</code></pre>

<p>Die SWAP-Partition enthält die Auslagerungsdaten. Entspricht im Wesentlichen der Dateien pagefile.sys und hyberfil.sys unter Windows.</p>

<h3>Konsole</h3>

<p>Werden Befehle in die Konsole eingegeben, geschieht dies in der Regel als Benutzer. Werden root-Rechte benötigt steht vor dem Kommandos ein &lsquo;&#8217;su -&rsquo;&lsquo;.</p>

<h2>Installations-Schritte</h2>

<h3>Vorbereitung</h3>

<ul>
<li><p>Wir laden NUR die erste Installations CD/DVD herunter. Mehr werden wir nicht benötigen.</p></li>
<li><p>Wir kopieren/brennen das Image auf einen USB-Stick.
Wenn man &lsquo;&#8217;dd&rsquo; verwendet, sollte man ganz sicher sein, dass das Ziel wirklich der USB-Stick ist.
      dd if=~/Downloads/debian.img of=/dev/sdb bs=4048</p></li>
<li><p>Wir booten von USB-Stick.</p></li>
</ul>


<p>Während der gesamten Installation werden die Felder mit den Pfeiltasten oder der Tab-taste markiert.
In Listen werden einzelne Elemente mit der Leertaste ausgewählt. Eingaben werden mit der Enter-Taste vollzogen.
Wähle &ldquo;Install&rdquo; aus.</p>

<p><img src="/images/2013-09-05-debian-installieren/001.png" width="600" height="400"></p>

<h3>Konfiguration</h3>

<ul>
<li>Wir wählen die gewünschte Sprache aus.</li>
</ul>


<p><img src="/images/2013-09-05-debian-installieren/002.png" width="600" height="400"></p>

<ul>
<li>Ebenfalls die Region.</li>
</ul>


<p><img src="/images/2013-09-05-debian-installieren/003.png" width="600" height="400">
<img src="/images/2013-09-05-debian-installieren/004.png" width="600" height="400">
<img src="/images/2013-09-05-debian-installieren/005.png" width="600" height="400"></p>

<ul>
<li>Nun wählen wir die Einstellungen für Datum, Uhrzeit, Papierformat, Währung und Co aus.</li>
</ul>


<p><img src="/images/2013-09-05-debian-installieren/006.png" width="600" height="400"></p>

<ul>
<li>Das Tastaturlayout sollte mit dem vorhandenen übereinstimmen ;-) .</li>
</ul>


<p><img src="/images/2013-09-05-debian-installieren/007.png" width="600" height="400"></p>

<ul>
<li>Schon geht es los mit der Hardwarerkennung.</li>
</ul>


<p><img src="/images/2013-09-05-debian-installieren/008.png" width="600" height="400">
<img src="/images/2013-09-05-debian-installieren/009.png" width="600" height="400">
<img src="/images/2013-09-05-debian-installieren/010.png" width="600" height="400"></p>

<ul>
<li>Wie soll der Computer heißen?</li>
</ul>


<p><img src="/images/2013-09-05-debian-installieren/011.png" width="600" height="400"></p>

<ul>
<li>Den Domainnamen können wir frei lassen.</li>
</ul>


<p><img src="/images/2013-09-05-debian-installieren/012.png" width="600" height="400"></p>

<ul>
<li>Das Root-Passwort sollte gut gewählt und nie vergessen werden. Das ganze Betriebssystem wird sonst unbrauchbar.
Man kann keine Software mehr über den Paketmanager installieren, Updates einspielen,
wichtige Systemeinstellungen verändern, usw.</li>
</ul>


<p><img src="/images/2013-09-05-debian-installieren/013.png" width="600" height="400"></p>

<ul>
<li>Nun ist der Standard-Nutzer dran. Das ist der, den man später in der Regel zum Arbeiten benutzt.</li>
</ul>


<p><img src="/images/2013-09-05-debian-installieren/016.png" width="600" height="400">
<img src="/images/2013-09-05-debian-installieren/017.png" width="600" height="400"></p>

<ul>
<li>Jetzt wird die vorhandene Hardware überprüft und die passenden Komponenten (Treiber, Laptop-Module, etc.)
dazu raus gesucht.</li>
</ul>


<p><img src="/images/2013-09-05-debian-installieren/018.png" width="600" height="400">
<img src="/images/2013-09-05-debian-installieren/019.png" width="600" height="400"></p>

<h3>Partitionierung</h3>

<ul>
<li>Es beginnt ein wichtiger Schritt für ein sicher eingerichtetes Betriebssystem - Die Partitionierung.
Wähle manuelle Partitionierung aus.</li>
</ul>


<p> <img src="/images/2013-09-05-debian-installieren/020.png" width="600" height="400"></p>

<ul>
<li>Wir wählen die Festplatte aus, auf der das System installiert werden soll.</li>
</ul>


<p><img src="/images/2013-09-05-debian-installieren/021.png" width="600" height="400"></p>

<ul>
<li>Wenn die Platte neu ist, wird es wahrscheinlich noch keine Partitionstabelle geben.
Diese muss erst erzeugt werden.</li>
</ul>


<p><img src="/images/2013-09-05-debian-installieren/022.png" width="600" height="400"></p>

<ul>
<li>Sollte die Platte schon eine Partitionstabelle haben, kommt man gleich hier her.
Sind bereits Partitionen vorhanden, so löschen wir diese indem man sie mit dem Pfeiltasten rot markiert
und Enter drückt. In dem Untermenu wird löschen ausgewählt und bestätigt.</li>
</ul>


<p><img src="/images/2013-09-05-debian-installieren/023.png" width="600" height="400"></p>

<ul>
<li>Wenn die Platte nichts enthält, können wir mit der benötigten Partitionierung beginnen.
Wir wählen &ldquo;FREE SPACE&rdquo; aus (dieser sollte so groß wie deine ganze Festplatte sein).</li>
</ul>


<p><img src="/images/2013-09-05-debian-installieren/024.png" width="600" height="400"></p>

<ul>
<li>Die erste Partition ist die Boot-Partition, sie benötigt nicht sehr viel Platz. 500 MB reichen vollkommen aus.
Hier landen später nur Kernel und ein paar Dateien zum Booten.</li>
</ul>


<p><img src="/images/2013-09-05-debian-installieren/025.png" width="600" height="400"></p>

<ul>
<li>Diese Partition soll eine &ldquo;Primary&rdquo; sein.</li>
</ul>


<p><img src="/images/2013-09-05-debian-installieren/026.png" width="600" height="400"></p>

<ul>
<li>Und am Anfang der Festplatte liegen.</li>
</ul>


<p><img src="/images/2013-09-05-debian-installieren/027.png" width="600" height="400"></p>

<ul>
<li>Es ist wichtig, dass &lsquo;Use as Ext4&rsquo; (oder ein anderes UNIX kompatibles Dateisystem enthält)
und das der &lsquo;Mount point: /boot&rsquo; ausgewählt ist.</li>
</ul>


<p><img src="/images/2013-09-05-debian-installieren/028.png" width="600" height="400"></p>

<ul>
<li>Bestätigt werden die Einstellungen über &lsquo;Done setting up the partition&rsquo;.</li>
</ul>


<p><img src="/images/2013-09-05-debian-installieren/031.png" width="600" height="400"></p>

<ul>
<li>In der Partitionsübersicht wird wieder &lsquo;FREE SPACE&rsquo;, dann &lsquo;Primary&rsquo; und &lsquo;Begin&rsquo; der Platte
ausgewählt. Die Größe ist davon abhängig, ob man später mehr Platz als Benutzer oder im System benötigt. Bei einer
500 GB Festplatte sind 100 GB für das System meist ausreichend. In der Systempartition landen in der Regel nur Programme und
andere Betriebssystem-relevanten Dinge. Einstellungsdateien, Bilder, Videos, Daten, &hellip; werden im Verzeichnis
des jeweiligen Nutzers abgelegt. Deshalb wird dort deutlich mehr Platz benötigt, als in der Systempartition.
<strong>WICHTIG</strong>: Dieses mal muss unter &lsquo;Usa as&rsquo; nicht ext4 sondern &lsquo;physical volume for encryption&rsquo; ausgewählt werden.
Wir wollen schließlich das System verschlüsseln.</li>
</ul>


<p><img src="/images/2013-09-05-debian-installieren/029.png" width="600" height="400"></p>

<ul>
<li>Die Partitionierungsübersicht sieht wie folgt aus:</li>
</ul>


<p><img src="/images/2013-09-05-debian-installieren/030.png" width="600" height="400"></p>

<ul>
<li><p>Hat der Rechner 4 GB und mehr RAM, so kann problemlos auf die Partition für die Auslagerungsdateien (SWAP)
verzichtet werden. Das heißt, der restliche Platz auf der Platte kann für Nutzerdaten verwendet werden. Ist dem
nicht so, ziehe von der nächsten Partition etwas platz ab. 1,2 bis 1,5-fache des RAM ist ein guter Wert, für den
Platz der übrig bleiben soll. In unserem Fall richten wir nach der Systempartition eine Home- und SWAP-Partition
ein.</p></li>
<li><p>Am Ende sieht unsere Partitionstabelle ungefähr wie im Bild aus (Lass dich nicht von den von mir verwendeten Partitionsgrößen irritieren. Um diese Anleitung zu schreiben, habe ich den gesamten Installationsvorgang in einer virtuellen Maschine durchgeführt.) Die erste ist zum Booten des Systems gedacht, sie muss deshalb unverschlüsselt bleiben. Die zweite ist für das Betriebssystem gedacht, die Dritte für die Nutzerdaten und die Vierte für die Auslagerungsdateien. Alle von #2 bis #4 werden verschlüsselt eingerichtet. Somit können keine Daten aus dem System gelesen werden. <strong>Achtung</strong>: Es sind weiterhin Angriffe über die Bootpartition möglich. Ein Dieb oder Spion kann aber mit einem gestohlenen oder entwendeten Gerät (z.B. am Flughafen) nichts anfangen. Nach einer Entwendung, egal durch wem, sollte das System nicht weiter benutzt werden, da die Boot-Partition verändert sein kann.</p></li>
</ul>


<p><img src="/images/2013-09-05-debian-installieren/032.png" width="600" height="400"></p>

<ul>
<li><p>Merke dir das Setup der Partitionen. Wir werden es später noch brauchen. In der SCSI1 steht in Klammern &lsquo;sda&rsquo;. Das ist so etwas wie der Name unserer Platte vor dem Mounten. #1 bis #4 darunter müssen nicht zwangsläufig in geordneter Reihenfolge sein. Es kann durchaus gemischt sein. Es ist aber wichtig, dass du die Nummer der Partitionen und den von dir angedachten Zweck kennst. Später heißen die Partitionen nicht #1, #2, &hellip; sondern sda1, sda2, &hellip; . Ist z.B. das Sytem #1, die Bootpartition #2, SWAp #3 und das Nutzerverezichnis #4, dann ist das wichtig zu wissen.</p></li>
<li><p>Nun werden die Verschlüsselungen eingerichtet. Dazu wird &lsquo;Configure encryptet volumes&rsquo; ausgewählt.</p></li>
</ul>


<p><img src="/images/2013-09-05-debian-installieren/033.png" width="600" height="400"></p>

<ul>
<li>Vorher werden wir noch gefragt, ob die Einstellungen auch wirklich richtig sind, da sie nun auf die Festplatte geschrieben werden.</li>
</ul>


<p><img src="/images/2013-09-05-debian-installieren/034.png" width="600" height="400"></p>

<ul>
<li>Wir erstellen verschlüsselte Partitionen.</li>
</ul>


<p><img src="/images/2013-09-05-debian-installieren/035.png" width="600" height="400"></p>

<ul>
<li>Die verschlüsselten Platten (steht in Klammern &lsquo;crypto&rsquo;) werden mit der Leertaste ausgewählt. Wir setzen mit &lsquo;Continue&rsquo; fort.</li>
</ul>


<p><img src="/images/2013-09-05-debian-installieren/036.png" width="600" height="400"></p>

<ul>
<li>&lsquo;Finish&rsquo;.</li>
</ul>


<p><img src="/images/2013-09-05-debian-installieren/039.png" width="600" height="400"></p>

<ul>
<li>Nun kommt noch die Frage, ob der Platz der Partitionen mit Zufallszahlen überschrieben werden soll. Wenn die Platte vorher keine sensiblen Daten enthielt überspringen wir besser diesen Schritt, da er mehrere Stunden dauert. &lsquo;No&rsquo;.</li>
</ul>


<p><img src="/images/2013-09-05-debian-installieren/040.png" width="600" height="400"></p>

<ul>
<li>Jetzt werden die Passphrasen (Passwort) der einzelnen Partitionen abgefragt. Verwende für jede Partition eine andere Passphrase und merke dir diese gut. Im Bild sieht man oben rechts #3, das bedeutet das es sich um Partition #3 handelt. <strong>Hinweis</strong>: Wir erinnern uns, dass wir die zuordnung von Partition, Funktion und dem gewählten Passwort später noch benötigen werden.</li>
</ul>


<p><img src="/images/2013-09-05-debian-installieren/041.png" width="600" height="400">
<img src="/images/2013-09-05-debian-installieren/042.png" width="600" height="400"></p>

<ul>
<li>Nachdem alle Passwörter gesetzt sind, landen wir wieder im Partitionsmenu. Es sind viele Einträge hinzugekommen; z.B. &lsquo;Encryptet volume (sda2_crypt)&rsquo;.</li>
</ul>


<p><img src="/images/2013-09-05-debian-installieren/043.png" width="600" height="400"></p>

<ul>
<li>Die Partitionen werden der Reihe nach ausgewählt. sda2_crypt ist der verschlüsselte Teil von #2 aus der Liste (SCSI1) direkt darunter und deine angedachte System-partition, sda3_crypt die Home und sda4_crypt die SWAP. (Die Buchstaben und Zahlen können sich auf deinem System unterscheiden.)</li>
</ul>


<p><img src="/images/2013-09-05-debian-installieren/044.png" width="600" height="400"></p>

<ul>
<li><p>Die System-Partition bekommt den &lsquo;Mount point: /&rsquo;, Die Home-partition &lsquo;/home&rsquo; und &hellip;
<img src="/images/2013-09-05-debian-installieren/045.png" width="600" height="400"></p></li>
<li><p>Die SWAP Partition bekommt keinen mount point, da dies wegen der Verschlüsselung später eingestellt wird.</p></li>
</ul>


<p><img src="/images/2013-09-05-debian-installieren/046.png" width="600" height="400"></p>

<ul>
<li>Am Ende sieht deine Partitionierung ungefähr so aus:</li>
</ul>


<p><img src="/images/2013-09-05-debian-installieren/047.png" width="600" height="400"></p>

<ul>
<li>Nun kannst du das Menu verlassen. Das Schwierigste ist geschafft.</li>
</ul>


<p><img src="/images/leitstelle/2013-09-05-debian-installieren/048.png" width="600" height="400"></p>

<ul>
<li>Der Installer ist unzufrieden, dass die für SWAP angedachte Partition (hier sda4_crypt) keinen &lsquo;mount point&rsquo; hat. Das ist uns erst mal egal: &lsquo;No&rsquo;.</li>
</ul>


<p><img src="/images/2013-09-05-debian-installieren/049.png" width="600" height="400"></p>

<ul>
<li>Da die SWAP noch nicht konfiguriert ist, will der Installer wissen ob du dir sicher bist oder zurück willst. Wir gehen nicht zurück: &lsquo;No&rsquo;.</li>
</ul>


<p><img src="/images/2013-09-05-debian-installieren/050.png" width="600" height="400"></p>

<ul>
<li>Wir sind fertig. Nun werden die Einstellungen übernommen und auf die Festplatte geschrieben.</li>
</ul>


<p><img src="/images/2013-09-05-debian-installieren/051.png" width="600" height="400"></p>

<h3>Abschluss der Installation</h3>

<ul>
<li>Anschließend wird das Grundsystem installiert.</li>
</ul>


<p><img src="/images/2013-09-05-debian-installieren/052.png" width="600" height="400"></p>

<ul>
<li>Nun werden wir gefragt, ob wir weitere Installatins-CDs verwenden möchten, da wir keine haben und keine weiteren benötigen, können wir fortfahren.</li>
</ul>


<p><img src="/images/2013-09-05-debian-installieren/053.png" width="600" height="400"></p>

<ul>
<li>Hat der Rechner Anschluss ans Internet, können bei der Installation des restlichen Systems gleich Updates mit eingespielt werden.</li>
</ul>


<p><img src="/images/2013-09-05-debian-installieren/054.png" width="600" height="400">
<img src="/images/2013-09-05-debian-installieren/055.png" width="600" height="400"></p>

<ul>
<li>Nun wird es nochmals kurz knifflig. Wenn das Betriebssystem das einzige auf der Festplatte ist, so kann der &lsquo;boot loader&rsquo; in den &lsquo;master boot record&rsquo; geschrieben werden. Sind noch andere Betriebssysteme im Einsatz und wird eine separater Bootmanager verwendet empfiehlt es sich den Boot-Loader in die Boot-Partition zu kopieren. In unserer Konfiguration haben wir nur das eine Betriebssystem und wählen deshalb &lsquo;Yes&rsquo; aus.</li>
</ul>


<p><img src="/images/2013-09-05-debian-installieren/056.png" width="600" height="400">
<img src="/images/2013-09-05-debian-installieren/058.png" width="600" height="400"></p>

<ul>
<li>Die Installation ist nun fast fertig.</li>
</ul>


<p><img src="/images/2013-09-05-debian-installieren/060.png" width="600" height="400">
<img src="/images/2013-09-05-debian-installieren/061.png" width="600" height="400"></p>

<h3>Schlüsselableitung und Konfiguration von fstab und cryptab</h3>

<ul>
<li><p>Nun wird das System neu gestartet.</p></li>
<li><p>Jetzt müssen zum letzten mal die Passwörter für jede Partition eingegeben werden. Durch eine Schlüsselableitung kann man mit einer entsperrten Partition andere entsperren.</p></li>
<li><p>Wir betrachten unsere Partitionen etwas näher an. Dazu loggen wir uns als root-User ein (Systemadministrator) und schauen uns unsere verschlüsselten Partitionen an.</p>

<pre><code>  su -
  cryptsetup luksDump /dev/sda2
  cryptsetup luksDump /dev/sda3
  cryptsetup luksDump /dev/sda4
</code></pre></li>
</ul>


<p>Die Ergebnisse sehen in etwa wie folgt aus:</p>

<p><img src="/images/2013-09-05-debian-installieren/066.png" width="600" height="400">
<img src="/images/2013-09-05-debian-installieren/067.png" width="600" height="400">
<img src="/images/2013-09-05-debian-installieren/068.png" width="600" height="400"></p>

<ul>
<li><p>Neben den Verschlüsselungoptionen fällt uns auf, dass immer nur ein &lsquo;Key Slot&rsquo; belegt ist. Man kann eine Partition nicht nur mit einem Schlüssel/Passwort entsperren sondern mit mehreren.</p></li>
<li><p>Beginnen wir die Schlüsselableitung:</p></li>
<li><p>Wir erstellen eine neue Partition, die nur im Arbeitsspeicher existiert:</p>

<pre><code>  su -
  mkdir -p /mnt/ram &amp;&amp; mount -t ramfs -o size=1m ramfs /mnt/ram &amp;&amp; chmod 755 /mnt/ram
</code></pre></li>
</ul>


<p><img src="/images/leitstelle/2013-09-05-debian-installieren/069.png" width="600" height="400"></p>

<ul>
<li><p>Jetzt leiten wir den Schlüssel von der Systempartition ab und fügen ihn der Home-Partition hinzu.</p>

<pre><code>  su -
  /lib/cryptsetup/scripts/decrypt_derived sda2_crypt &gt; /mnt/ram/tmp.key
  cryptsetup luksAddKey /dev/sda3 /mnt/ram/tmp.key
</code></pre></li>
</ul>


<p><img src="/images/2013-09-05-debian-installieren/070.png" width="600" height="400"></p>

<ul>
<li><p>Man wird nun aufgefprdert ein Passwort einzugeben. Da die Home-Partition einen neuen Schlüssel bekommt ist auch das Passwort dieser einzugeben.</p></li>
<li><p>Da wir mit der Systempartition auch die SWAP-Partition entschlüsseln wollen, können wir den Schlüssel gleich weiter verwenden und ihn SWAP hinzufügen.</p>

<pre><code>  su -
  cryptsetup luksAddKey /dev/sda4 /mnt/ram/tmp.key
</code></pre></li>
<li><p>Auch hier muss das Passwort der Zielpartition (für SWAP) eingegeben werden.</p></li>
<li><p>Nun löschen wir den Schlüssel und entfernen die Partition:</p>

<pre><code>  su -
  rm /mnt/ram/tmp.key
  umount /mnt/ram/ &amp;&amp; rmdir /mnt/ram/
</code></pre></li>
</ul>


<p><img src="/images/2013-09-05-debian-installieren/073.png" width="600" height="400"></p>

<ul>
<li><p>Jetzt müssen wir dem System sagen, dass sich einige Einstellungen geändert haben.</p></li>
<li><p>zuerst stellen wir ein, dass wir nicht mehr alle Passwörter von Hand eingeben.</p></li>
<li><p>Dazu benötigen wir die IDs der Partitionen. Diese erhalten wir mit:</p>

<pre><code>  su -
  blkid /dev/sda3
  blkid /dev/sda4
</code></pre></li>
</ul>


<p><img src="/images/2013-09-05-debian-installieren/074.png" width="600" height="400"></p>

<ul>
<li><p>Nun editieren wir die Datei, die während des Bootens Partionen entschlüsselt.</p>

<pre><code>  su -
  nano /etc/crypttab
</code></pre></li>
</ul>


<p>Anfangs wird sie vermutlich so ähnlich aussehen:</p>

<p><img src="/images/2013-09-05-debian-installieren/075.png" width="600" height="400"></p>

<ul>
<li>Wir verändern die Datei so, dass die Root-partition unverändert bleibt. Für die Home und SWAP verändern wir, dass diese nun mittels der System-Partition entsperrt wird. Das erreichen wir indem wir, statt dem &lsquo;none&rsquo; &lsquo;sda2_crypt&rsquo; einsetzten und nach dem &lsquo;luks&rsquo; noch &lsquo;keyscript=/lib/cryptsetup/scripts/decrypt_derived&rsquo; einfügen. (Die Lesart der Konfiguration ist ungefähr: Die Mount-Punkt &lsquo;sda3_crypt&rsquo; soll durch die Partition UUID=abcBuchstabensalat besetzt werden. Ensperrt wird sie von der Partition &lsquo;sda2_crypt&rsquo; mittels dem Script aus &lsquo;/lib/cryptsetup/scripts/decrypt_derived&rsquo;.)</li>
</ul>


<p><img src="/images/2013-09-05-debian-installieren/077.png" width="600" height="400"></p>

<ul>
<li><p>Nun muss noch die Filesystem-Tabelle geändert werden. Dazu:</p>

<pre><code>  su -
  nano /etc/fstab
</code></pre></li>
</ul>


<p><img src="/images/2013-09-05-debian-installieren/079.png" width="600" height="400"></p>

<ul>
<li><p>Da Boot, System und Home schon während der Installation verwendet wurden, muss nur noch die SWAP ergänzt werden. Dazu muss die folgende Zeile eingefügt werden:</p>

<pre><code>  /dev/mapper/sda4_crypt    swap    swap    sw    0    0
</code></pre></li>
</ul>


<p><img src="/images/2013-09-05-debian-installieren/080.png" width="600" height="400"></p>

<ul>
<li><p>Zum Schluss muss die Veränderungen ins System übernommen werden, damit beim Neustart alles Reibungslos funktioniert:</p>

<pre><code>  su -
  update-initramfs -u -k all
</code></pre></li>
</ul>


<p><img src="/images/2013-09-05-debian-installieren/081.png" width="600" height="400"></p>

<ul>
<li>Jetzt kann das System neu gestartet werden. Es ist verschlüsselt und es muss nur noch ein Passwort eingegeben werden. Bei einem Systemcrash kann die Platte ausgebaut werden und mittels des zu erst von Hand eingegeben Passwortes entsperrt werden und die Daten gerettet werden.</li>
</ul>


<h3>Fertig</h3>
]]></content>
  </entry>
  
</feed>
